---
TOCTitle: 監控 Message Queuing
Title: 監控 Message Queuing
ms:assetid: 'a7109399-3a84-4681-874b-f6ea1646b0a0'
ms:contentKeyID: 18113061
ms:mtpsurl: 'https://technet.microsoft.com/zh-tw/library/Cc747716(v=WS.10)'
---

監控 Message Queuing
====================

RMS 記錄使用訊息佇列 (也稱為 MSMQ) 來傳送事件到記錄資料庫。每一個 RMS 前端伺服器送出訊息到訊息佇列服務，而每一個前端伺服器上的記錄接聽程式服務從訊息佇列的佇列擷取記錄訊息，然後將其寫入記錄資料庫。如果您的記錄資料庫或資料庫伺服器無法使用，或是記錄接聽程式服務停止了，訊息佇列會將訊息儲存在佇列中。如果您計畫要關閉記錄資料庫或資料庫伺服器，建議您先關閉每一個前端伺服器上的記錄接聽程式服務，然後在重新啟動資料庫或資料庫伺服器之後，重新啟動每一個前端伺服器的記錄接聽程式服務。

如果資料庫無法使用而記錄接聽程式服務仍在執行中，記錄接聽程式服務將無法把記錄訊息寫入資料庫中。記錄接聽程式服務會將訊息移至「寄不出的信件」Message Queuing 的佇列，直到資料庫可使用時，新的記錄訊息才會寫入資料庫。在「寄不出的信件」訊息佇列中的訊息不會自動寫入記錄資料庫。請使用下列步驟檢視或刪除在「寄不出的信件」訊息佇列中的訊息：

1.  按一下 **\[開始\]**，指向 **\[所有程式\]**，再指向 **\[系統管理工具\]**，然後按一下 **\[電腦管理\]** 以開啟 Microsoft Management Console (MMC) 電腦管理嵌入式管理單元。
2.  在主控台樹狀目錄中的 \[服務及應用程式\] 之下，按一下 Message Queuing，然後按一下 \[私用佇列\]。
3.  您會看到兩個佇列。兩個佇列的名稱都是以 "**drms\_logging**" 開頭，後接叢集名稱。其中一個佇列會以「**drms\_logging***\_&lt;您的叢集名稱&gt;*\_**deadletter**」方式命名。這是寄不出的信件佇列。按一下佇列名稱，然後按一下 \[佇列訊息\] 佇列。
4.  連按兩下每則訊息以檢視其內容。
5.  若要刪除佇列，請在 **\[佇列訊息\]** 佇列上按一下滑鼠右鍵，選取 **\[所有工作\]**，然後按一下 **\[清除\]**。

在預設的設定中，訊息佇列會儲存所有的佇列訊息，直到達到伺服器上可用的儲存空間限制為止。如果訊息佇列用掉所有可用的硬碟空間，RMS 伺服器就無法服務用戶端要求。為避免此狀況發生，請使用下列步驟限制訊息佇列可使用於佇列的磁碟空間量：

1.  按一下 \[開始\]，指向 \[所有程式\]，再指向 \[系統管理工具\]，然後按一下 \[電腦管理\] 以開啟 Microsoft Management Console (MMC) 電腦管理嵌入式管理單元。
2.  在主控台樹狀目錄中的 \[服務及應用程式\] 之下，按一下 Message Queuing，然後按一下 \[私用佇列\]。
3.  您會看到兩個佇列。兩個佇列的名稱都是以「drms\_logging」開頭。在每一個佇列上執行下列步驟：
    -   按一下 \[內容\]。
    -   選取 \[訊息存放區限制為 (KB)\] 核取方塊，然後鍵入可以儲存在佇列中所有佇列訊息的全部大小 (以千位元組為單位)。

如果佇列已滿，來自 RMS 的訊息在到達時會被捨棄，而下列和事件識別碼 48 關聯的的事件訊息會傳送到 \[系統\] 事件日誌：

「傳送屬性包至 Message Queuing 失敗。」

建議您設定系統監看工具在此事件發生時警告您，因為這是記錄資料庫有問題的訊號。
